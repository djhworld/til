<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>TIL - Today I Learned - til.djharper.dev</title>

      
        <link rel="alternate" type="application/atom+xml" title="RSS" href="https://til.djharper.dev/atom.xml">
      

      
      <!-- <link rel="stylesheet" href="https://til.djharper.dev/site.css">-->
      <link rel="stylesheet" href="/site.css">
      

      
      
    </head>

    <body class="hack dark main container">
        
    
        
                
                    <header>
                        <nav itemscope itemtype="http://schema.org/SiteNavigationElement">
                        
                            <a itemprop="url"
                               class=""
                               href="https:&#x2F;&#x2F;til.djharper.dev">
                                <span itemprop="name">Home
                                </span></a>
                        
                            <a itemprop="url"
                               class=""
                               href="https:&#x2F;&#x2F;til.djharper.dev&#x2F;tags">
                                <span itemprop="name">Tags
                                </span></a>
                        
                            <a itemprop="url"
                               class=""
                               href="https:&#x2F;&#x2F;djharper.dev">
                                <span itemprop="name">djharper.dev
                                </span></a>
                        
                        </nav>
                    </header>
                
            
    

<article itemscope itemtype="http://schema.org/BlogPosting">
    <header>
        <h1 itemprop="headline">You can use testing.Skip() instead of build tags for integration tests</h1>
        <span class="muted">
    <svg style="margin-bottom: -3px" class="i-edit" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
        stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <path d="M30 7 L25 2 5 22 3 29 10 27 Z M21 6 L26 11 Z M5 22 L10 27 Z"/>
    </svg>

    Published: 2021-05-05
</span>
        
            in
            
                  <a href="https://til.djharper.dev/tags/golang/">golang</a>
            
                  <a href="https://til.djharper.dev/tags/testing/">testing</a>
            
        

    </header>
    <hr/>
    <div itemprop="articleBody">
      <p>A pattern I've seen often in Go is to use build tags for integration tests, so you could exclude them when running <code>go test</code> </p>
<p>This works OK but has some pitfalls, especially around IDEs and other tooling which often does not lint or compile build tags unless explicity set, so compiler errors will not surface.</p>
<p>After reading <a href="https://peter.bourgon.org/blog/2021/04/02/dont-use-build-tags-for-integration-tests.html">dont-use-build-tags-for-integration-tests</a> I've started to try using the <code>t.Skip()</code> instead with an environment variable.</p>
<p>For example: </p>
<pre style="background-color:#272822;">
<code class="language-go" data-lang="go"><span style="font-style:italic;color:#66d9ef;">func </span><span style="color:#a6e22e;">TestIntegration</span><span style="color:#f8f8f2;">(</span><span style="font-style:italic;color:#fd971f;">t </span><span style="color:#f92672;">*</span><span style="color:#f8f8f2;">testing.</span><span style="font-style:italic;color:#66d9ef;">T</span><span style="color:#f8f8f2;">) {
	integrationFlag </span><span style="color:#f92672;">:= </span><span style="color:#f8f8f2;">os.Getenv(</span><span style="color:#e6db74;">&quot;INTEGRATION&quot;</span><span style="color:#f8f8f2;">)
	</span><span style="color:#f92672;">if </span><span style="color:#f8f8f2;">integrationFlag </span><span style="color:#f92672;">== </span><span style="color:#e6db74;">&quot;&quot; </span><span style="color:#f8f8f2;">{
		t.Skip(</span><span style="color:#e6db74;">&quot;set INTEGRATION to run this test&quot;</span><span style="color:#f8f8f2;">)
	}

	</span><span style="color:#75715e;">// ...
</span><span style="color:#f8f8f2;">}
</span></code></pre>
    </div>

    
        <footer>
            <hr>
            <p>
                
                    Published by Daniel
                
                
                
                    and tagged
                    
                        <a href="https://til.djharper.dev/tags/golang/">golang</a>
                        
                            
                                
                                    and
                                
                            
                        
                    
                        <a href="https://til.djharper.dev/tags/testing/">testing</a>
                        
                            
                        
                    
                
            </p>
            
            
        </footer>
    
</article>


    </body>

</html>
